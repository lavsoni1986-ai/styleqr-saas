generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


model User {
  id            String       @id @default(uuid())
  email         String       @unique
  name          String?
  password      String?
  role          Role         @default(RESTAURANT_OWNER)
  districtId    String?
  partnerId     String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  commissions   Commission[]
  ownedDistrict District?    @relation("DistrictAdmin")
  ownedPartner  Partner?     @relation("PartnerOwner")
  restaurants   Restaurant[]
  shifts        Shift[]
  tips          Tip[]
  district      District?    @relation(fields: [districtId], references: [id])
  partner       Partner?     @relation(fields: [partnerId], references: [id])
  whiteLabels   WhiteLabel[]

  @@index([districtId])
  @@index([partnerId])
  @@index([role])
}

model District {
  id          String       @id @default(uuid())
  name        String
  code        String       @unique
  region      String?
  adminId     String       @unique
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  admin       User         @relation("DistrictAdmin", fields: [adminId], references: [id], onDelete: Cascade)
  partners    Partner[]
  restaurants Restaurant[]
  users       User[]
  whiteLabels WhiteLabel[]

  @@index([adminId])
  @@index([code])
}

model Partner {
  id             String         @id @default(uuid())
  name           String
  companyName    String?
  email          String         @unique
  phone          String?
  districtId     String
  ownerId        String         @unique
  commissionRate Float          @default(10.0)
  whiteLabelId   String?        @unique
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  commissions    Commission[]
  district       District       @relation(fields: [districtId], references: [id], onDelete: Cascade)
  owner          User           @relation("PartnerOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  whiteLabel     WhiteLabel?    @relation("PartnerWhiteLabel", fields: [whiteLabelId], references: [id])
  restaurants    Restaurant[]
  subscriptions  Subscription[]
  users          User[]

  @@index([districtId])
  @@index([ownerId])
  @@index([whiteLabelId])
}

model WhiteLabel {
  id             String       @id @default(uuid())
  name           String
  domain         String       @unique
  subdomain      String?      @unique
  logo           String?
  favicon        String?
  theme          String       @default("orange")
  primaryColor   String?
  secondaryColor String?
  districtId     String?
  partnerId      String?
  ownerId        String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  isActive       Boolean      @default(true)
  partner        Partner?     @relation("PartnerWhiteLabel")
  restaurants    Restaurant[]
  district       District?    @relation(fields: [districtId], references: [id])
  owner          User         @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId])
  @@index([domain])
  @@index([subdomain])
  @@index([districtId])
  @@index([partnerId])
}

model Restaurant {
  id              String           @id @default(uuid())
  name            String
  ownerId         String
  whiteLabelId    String?
  partnerId       String?
  districtId      String?
  subscriptionId  String?          @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  bills           Bill[]
  billSequence    BillSequence?
  categories      Category[]
  commissions     Commission[]
  orders          Order[]
  paymentGateways PaymentGateway[]
  district        District?        @relation(fields: [districtId], references: [id])
  owner           User             @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  partner         Partner?         @relation(fields: [partnerId], references: [id])
  whiteLabel      WhiteLabel?      @relation(fields: [whiteLabelId], references: [id])
  settlements     Settlement[]
  shifts          Shift[]
  subscription    Subscription?    @relation("RestaurantSubscription")
  tables          Table[]

  @@index([ownerId])
  @@index([whiteLabelId])
  @@index([partnerId])
  @@index([districtId])
  @@index([subscriptionId])
}
